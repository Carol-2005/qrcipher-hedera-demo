import { ContractCreateFlow } from "@hashgraph/sdk";
import environmentSetup from "./setup";

export default async function createContract() {
    try {
        const client = await environmentSetup();
        
        const bytecode =
          "6080604052348015600e575f5ffd5b50335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610bf88061005b5f395ff3fe608060405234801561000f575f5ffd5b5060043610610049575f3560e01c80623381421461004d578063629d0bf614610069578063a81caae314610099578063e2be292f146100c9575b5f5ffd5b610067600480360381019061006291906106a9565b6100f9565b005b610083600480360381019061007e919061075b565b61030f565b60405161009091906107d2565b60405180910390f35b6100b360048036038101906100ae91906107eb565b6104d8565b6040516100c091906107d2565b60405180910390f35b6100e360048036038101906100de91906107eb565b610509565b6040516100f09190610932565b60405180910390f35b3373ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610187576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161017e906109d2565b60405180910390fd5b5f5f90505b83839050811015610309575f60018585848181106101ad576101ac6109f0565b5b90506020028101906101bf9190610a29565b6040516101cd929190610ac7565b908152602001604051809103902090505f429050815f0160405180604001604052808673ffffffffffffffffffffffffffffffffffffffff16815260200183815250908060018154018082558091505060019003905f5260205f2090600202015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151816001015550508373ffffffffffffffffffffffffffffffffffffffff167f246635853672a8d76266cacb8d7d322ec58b8f645e78eb5b83fb10db447a67c08787868181106102d0576102cf6109f0565b5b90506020028101906102e29190610a29565b846040516102f293929190610b2a565b60405180910390a25050808060010191505061018c565b50505050565b5f3373ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461039e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610395906109d2565b60405180910390fd5b5f600185856040516103b1929190610ac7565b90815260200160405180910390205f018054905011610405576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103fc90610ba4565b60405180910390fd5b5f60018585604051610418929190610ac7565b90815260200160405180910390209050805f0160405180604001604052808573ffffffffffffffffffffffffffffffffffffffff16815260200142815250908060018154018082558091505060019003905f5260205f2090600202015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010155505060019150509392505050565b5f5f600184846040516104ec929190610ac7565b90815260200160405180910390205f018054905011905092915050565b60606001838360405161051d929190610ac7565b90815260200160405180910390205f01805480602002602001604051908101604052809291908181526020015f905b828210156105da578382905f5260205f2090600202016040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820154815250508152602001906001019061054c565b50505050905092915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f84011261060f5761060e6105ee565b5b8235905067ffffffffffffffff81111561062c5761062b6105f2565b5b602083019150836020820283011115610648576106476105f6565b5b9250929050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6106788261064f565b9050919050565b6106888161066e565b8114610692575f5ffd5b50565b5f813590506106a38161067f565b92915050565b5f5f5f604084860312156106c0576106bf6105e6565b5b5f84013567ffffffffffffffff8111156106dd576106dc6105ea565b5b6106e9868287016105fa565b935093505060206106fc86828701610695565b9150509250925092565b5f5f83601f84011261071b5761071a6105ee565b5b8235905067ffffffffffffffff811115610738576107376105f2565b5b602083019150836001820283011115610754576107536105f6565b5b9250929050565b5f5f5f60408486031215610772576107716105e6565b5b5f84013567ffffffffffffffff81111561078f5761078e6105ea565b5b61079b86828701610706565b935093505060206107ae86828701610695565b9150509250925092565b5f8115159050919050565b6107cc816107b8565b82525050565b5f6020820190506107e55f8301846107c3565b92915050565b5f5f60208385031215610801576108006105e6565b5b5f83013567ffffffffffffffff81111561081e5761081d6105ea565b5b61082a85828601610706565b92509250509250929050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b6108688161066e565b82525050565b5f819050919050565b6108808161086e565b82525050565b604082015f82015161089a5f85018261085f565b5060208201516108ad6020850182610877565b50505050565b5f6108be8383610886565b60408301905092915050565b5f602082019050919050565b5f6108e082610836565b6108ea8185610840565b93506108f583610850565b805f5b8381101561092557815161090c88826108b3565b9750610917836108ca565b9250506001810190506108f8565b5085935050505092915050565b5f6020820190508181035f83015261094a81846108d6565b905092915050565b5f82825260208201905092915050565b7f4f6e6c792074686520636f6e7472616374206f776e65722063616e2063616c6c5f8201527f20746869732066756e6374696f6e000000000000000000000000000000000000602082015250565b5f6109bc602e83610952565b91506109c782610962565b604082019050919050565b5f6020820190508181035f8301526109e9816109b0565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83356001602003843603038112610a4557610a44610a1d565b5b80840192508235915067ffffffffffffffff821115610a6757610a66610a21565b5b602083019250600182023603831315610a8357610a82610a25565b5b509250929050565b5f81905092915050565b828183375f83830152505050565b5f610aae8385610a8b565b9350610abb838584610a95565b82840190509392505050565b5f610ad3828486610aa3565b91508190509392505050565b5f601f19601f8301169050919050565b5f610afa8385610952565b9350610b07838584610a95565b610b1083610adf565b840190509392505050565b610b248161086e565b82525050565b5f6040820190508181035f830152610b43818587610aef565b9050610b526020830184610b1b565b949350505050565b7f50726f64756374206e6f7420666f756e640000000000000000000000000000005f82015250565b5f610b8e601183610952565b9150610b9982610b5a565b602082019050919050565b5f6020820190508181035f830152610bbb81610b82565b905091905056fea26469706673582212209bbda68c1dd981d3ebb73105ffd32375137b03ff4033fa68477bb1200ed47f8364736f6c634300081e0033";

        const createContract = new ContractCreateFlow()
            .setGas(4000000)
            .setBytecode(bytecode);

        const createContractTx = await createContract.execute(client);
        const createContractRx = await createContractTx.getReceipt(client);
        const contractId = createContractRx.contractId;

        console.log(`Contract created with ID: ${contractId} \n`);

        return contractId;
    } catch (err) {
        console.log(err);
        throw new Error('Contract creation Failed');
    }
}