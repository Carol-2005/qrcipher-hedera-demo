import { ContractCreateFlow } from "@hashgraph/sdk";
import environmentSetup from "./setup";

export default async function createContract() {
    try {
        const client = await environmentSetup();
        
        const bytecode =
          "6080604052348015600e575f5ffd5b50335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506105f08061005b5f395ff3fe608060405234801561000f575f5ffd5b5060043610610034575f3560e01c8063a739007a14610038578063d4c1f19f14610068575b5f5ffd5b610052600480360381019061004d919061028b565b610084565b60405161005f91906102f0565b60405180910390f35b610082600480360381019061007d919061035e565b6100ba565b005b5f600183836040516100979291906103e5565b90815260200160405180910390205f9054906101000a900460ff16905092915050565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610148576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161013f9061047d565b60405180910390fd5b5f5f90505b8282905081101561021d5760018084848481811061016e5761016d61049b565b5b905060200281019061018091906104d4565b60405161018e9291906103e5565b90815260200160405180910390205f6101000a81548160ff0219169083151502179055507fc5d4861449b1cd27a693d2d1feb76f9c3605c08419dbd5e5445942aa9cbf2c328383838181106101e6576101e561049b565b5b90506020028101906101f891906104d4565b426040516102089392919061058a565b60405180910390a1808060010191505061014d565b505050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f84011261024b5761024a61022a565b5b8235905067ffffffffffffffff8111156102685761026761022e565b5b60208301915083600182028301111561028457610283610232565b5b9250929050565b5f5f602083850312156102a1576102a0610222565b5b5f83013567ffffffffffffffff8111156102be576102bd610226565b5b6102ca85828601610236565b92509250509250929050565b5f8115159050919050565b6102ea816102d6565b82525050565b5f6020820190506103035f8301846102e1565b92915050565b5f5f83601f84011261031e5761031d61022a565b5b8235905067ffffffffffffffff81111561033b5761033a61022e565b5b60208301915083602082028301111561035757610356610232565b5b9250929050565b5f5f6020838503121561037457610373610222565b5b5f83013567ffffffffffffffff81111561039157610390610226565b5b61039d85828601610309565b92509250509250929050565b5f81905092915050565b828183375f83830152505050565b5f6103cc83856103a9565b93506103d98385846103b3565b82840190509392505050565b5f6103f18284866103c1565b91508190509392505050565b5f82825260208201905092915050565b7f4f6e6c7920746865206f776e65722063616e2063616c6c20746869732066756e5f8201527f6374696f6e000000000000000000000000000000000000000000000000000000602082015250565b5f6104676025836103fd565b91506104728261040d565b604082019050919050565b5f6020820190508181035f8301526104948161045b565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5f833560016020038436030381126104f0576104ef6104c8565b5b80840192508235915067ffffffffffffffff821115610512576105116104cc565b5b60208301925060018202360383131561052e5761052d6104d0565b5b509250929050565b5f601f19601f8301169050919050565b5f61055183856103fd565b935061055e8385846103b3565b61056783610536565b840190509392505050565b5f819050919050565b61058481610572565b82525050565b5f6040820190508181035f8301526105a3818587610546565b90506105b2602083018461057b565b94935050505056fea2646970667358221220768fe15bd5dbcfc97b9230844d0ac622c857b681de99d0ca2d4303aed4c92dae64736f6c634300081e0033";

        const createContract = new ContractCreateFlow()
            .setGas(470000)
            .setBytecode(bytecode);

        const createContractTx = await createContract.execute(client);
        const createContractRx = await createContractTx.getReceipt(client);
        const contractId = createContractRx.contractId;

        console.log(`Contract created with ID: ${contractId} \n`);

        return contractId;
    } catch (err) {
        console.log(err);
        throw new Error('Contract creation Failed');
    }
}